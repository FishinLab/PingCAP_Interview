### 题目

两个 csv 文件，分别命名为 t1, t2，都由 a, b 两个整数列构成，每个文件的数据行数至少百万以上，请设计并实现一个算法快速计算出：

select count(*) from t1 join t2 on t1.a = t2.a and t1.b > t2.b

### 要求：
1. 充分利用机器的 CPU/MEM 资源，计算速度越快越好
2. 分析并测试该算法对机器资源的使用情况
3. 请分析并测试各个表中 a 的 number of distinct values 对该算法性能的影响
4. 请思考并列举出所有能想到的做法，越多越好。描述他们的优劣点，适用的场景，什么场景下执行的快，什么场景下执行的慢

### 分析：

从题目来看，可以将该题目抽象成简要实现一个join operator， 并且讨论在什么情况下使用不同的join方式最合适

csv文件可以抽象成两张表t1，t2， 其中t1与t2存在两列a，b

### 分析并测试该算法对机器资源的使用情况

数据库中join操作免不了将表加载内存，在实际的场景中内存的使用是至关重要的。

#### nest loop join
nest loop join将数据量小的表作为左表加载内存，再将数据量较大的表分批加载，如果内存空间充裕并在有统计信息的支撑下，可定策略加载右表到内存

#### hash join
hash join在内存中要实现一个hash table，将左表数据加载到hash table中，再通过右表不断探测hash table最终得到结果

### 请分析并测试各个表中 a 的 number of distinct values 对该算法性能的影响
如果有统计信息支撑，在选择join方式可以选择hash join来优化该场景，右表分批加载， 这样可以将内存使用优化到最佳

### 请思考并列举出所有能想到的做法，越多越好。描述他们的优劣点，适用的场景，什么场景下执行的快，什么场景下执行的慢

#### 存储对于表没有sharding
如果存储没有sharding，分批加载表

#### 存储对于表有sharding，并且下端存储有一定的执行能力
这样我们可以基于规则将join操作push down到各个sharding中，再汇聚所有sharding的计算结果

#### hash nest loop join
优化join算法

#### MPP
使用MPP进行多路join操作，最终汇总

#### 基于代价优化
在生成执行计划前根据统计信息选择左表，右表，链接方式等

### 扩展

#### 对于关联子查询的规则优化

#### 基于规则优化/基于代价优化

#### 机器学习在执行计划中的可能的应用
